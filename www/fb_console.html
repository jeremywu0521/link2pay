<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
	<link rel="shortcut icon" href="assets/images/logo2.png" type="image/x-icon">

	
	<title>CONSOLE - link2pay</title>
	<link rel="stylesheet" href="assets/web/assets/mobirise-icons/mobirise-icons.css">
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
	<link rel="stylesheet" href="assets/tether/tether.min.css">
	<link rel="stylesheet" href="assets/dropdown/css/style.css">
	<link rel="stylesheet" href="assets/theme/css/style.css">
	<link rel="preload" as="style" href="assets/mobirise/css/mbr-additional.css"><link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
	
	
</head>
<section class="menu cid-rFJZuJqK7i" once="menu" id="menu1-c">

    

    <nav class="navbar navbar-expand beta-menu navbar-dropdown align-items-center navbar-fixed-top navbar-toggleable-sm bg-color transparent">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
        <div class="menu-logo">
            <div class="navbar-brand">
                
                <span class="navbar-caption-wrap"><a class="navbar-caption text-success display-1" href="https://link2pay.mipodstudio.com/">
                        link2pay&nbsp;</a></span>
            </div>
        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav nav-dropdown" data-app-modern-menu="true"><li class="nav-item">
                    <a class="nav-link link text-white display-4" href="index.html">
                        <span class="mbri-home mbr-iconfont mbr-iconfont-btn"></span>
                        Services
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link link text-white display-4" href="http://link2pay.mipodstudio.com/add_change_user.html"><span class="mbri-setting3 mbr-iconfont mbr-iconfont-btn"></span>
                        
                        Setting</a>
                </li></ul>
            <div class="navbar-buttons mbr-section-btn"><a class="btn btn-sm btn-success display-4" href="http://link2pay.mipodstudio.com/fb_console.html"><span class="mbri-align-left mbr-iconfont mbr-iconfont-btn"></span>
                    
                    Console</a></div>
        </div>
    </nav>
</section>

<section class="engine"><a href=""></a></section><section class="cid-rFKb5IM3v1 mbr-fullscreen" id="header2-e">

    

    

    <div class="container align-center">
        <div class="row justify-content-md-center">
            <div class="mbr-white col-md-10">
                
					<fb:login-button class="fb-login"
					scope="public_profile,email"
					onlogin="checkLoginState();">
				Login(With Facebook)
				</fb:login-button>
				
				<div id="orders_list"><div>
				
				
				
                
                <div class="mbr-section-btn">
					<a class="btn btn-md btn-secondary display-4" onclick="$('#createLink_modal').modal('show');" >Create Link</a>
                    <a class="btn btn-md btn-white-outline display-4" onclick="window.location.replace('/add_change_user.html');">change user Setting</a></div>
            </div>
        </div>
    </div>
</div>
</section>

<section once="footers" class="cid-rFK8yYAPQn fixed-bottom" id="footer6-d">

    <div class="container ">
        <div class="media-container-row align-center mbr-white">
            <div class="col-12">
                <p class="mbr-text mb-0 mbr-fonts-style display-7">
                    Â©Mipod Studio - link2pay beta for contest demo only&nbsp;</p>
            </div>
        </div>
    </div>
</section>
<div id="createLink_modal" class="modal inmodal fade"  tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="true">
		<div class="modal-dialog modal-lg" >
		  <div class="modal-content">
			<div class="modal-header">
				<div class="modal-title ">Create Link </div>
			  <button type="button" class="close" data-dismiss="modal">
				<span>&times;</span>
			  </button>

			</div>
			<div class="modal-body" >
					<form>
						<div class="form-group">
							<label class="col-form-label">Title:</label>
							<input type="text" class="form-control" id="createLink_formTitle">
						</div>
						<div class="form-group">
								<label class="col-form-label">Amount:</label>
								<input step="number" type="number" class="form-control" id="createLink_formAmount">
						</div>
						<div class="form-group">
							<label  class="col-form-label">Description: <p>(optional)</p></label>
							<textarea class="form-control" id="createLink_formDescription"></textarea>
						</div>
					 </form>
			</div>
			<div class="modal-footer" >
			  <button class="btn" data-dismiss="modal">Cancel</button>
			  <button class="btn btn-secondary" onclick="createLink();">Create</button>
			</div>
		  </div>
		</div>
	  </div>

	  <div class="modal" id="createOrder_result_modal" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
			  <div class="modal-content">
				<div class="modal-header">
				  <h3 class="modal-title">Created Link Successfully</h3>
				  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				  </button>
				</div>
				<div class="modal-body">
					
					<div class="form-group">
						<input class="form-control" type="text" class=" form " id="createOrder_result_link">
						<button onclick="copylink();">Copy</button>
					</div>
					  
				</div>
				<div class="modal-footer">
				  <button type="button" class="btn btn-primary"onclick="copylink();">Copy Link</button>
				  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			  </div>
			</div>
	</div>
<script src="assets/web/assets/jquery/jquery.min.js"></script>
<script src="assets/popper/popper.min.js"></script>
<script src="assets/bootstrap/js/bootstrap.min.js"></script>
<script src="assets/tether/tether.min.js"></script>
<script src="assets/smoothscroll/smooth-scroll.js"></script>
<script src="assets/dropdown/js/nav-dropdown.js"></script>
<script src="assets/dropdown/js/navbar-dropdown.js"></script>
<script src="assets/touchswipe/jquery.touch-swipe.min.js"></script>
<script src="assets/parallax/jarallax.min.js"></script>
<script src="assets/theme/js/script.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
	jQuery.noConflict();
	// onLoad -> checkLoginState() =>upstatus_cb() ->
	//user	not exist=> redirect to add
	//user exist => show details()
	//
	var fb_info;
	function copylink() {
		var textBox = document.getElementById("createOrder_result_link");
		textBox.select();
		document.execCommand("copy");
	}
	function createLink(){
		var order_title = $('#createLink_formTitle').val();
		var order_amount = $('#createLink_formAmount').val();
		var order_description = $('#createLink_formDescription').val()||undefined;
		createOrder(fb_info.authResponse.userID.toString(),order_amount,order_title,order_description);
	}
	
  function createOrder(owner,amount,title,description){
		$.post('./create',{owner:owner,amount:amount,title:title,description:description},(data)=>{
					data=JSON.parse(data);
					if(data.status=='success'){

						//alert('create Succee! \n please copylink(); >Copy</button>the link \n '+'https://link2pay.mipodstudio.com/'+data.serial);
						$('#createLink_modal').modal('hide');
						$('#createOrder_result_link').val('https://link2pay.mipodstudio.com/'+data.serial);
						$('#createOrder_result_modal').modal('show');
						copylink();
						$('#createOrder_result_modal').on('hidden.bs.modal', function (e) {
							window.location.reload();
						});
					}else{
						alert('create failed');
					}
				});
	}
	function deleteOrder(serial,owner){
		$.post('./delete',{serial:serial,owner:owner},(data)=>{
			data=JSON.parse(data);
					if(data.status=='success'){
						window.location.reload();
					}else{
						alert('failed to delete order');
					}
		});
	}
	function showUserInfo(data){
		console.log(data);
		var owner_json = data;
				if(owner_json.orders.length !=0){
					owner_json.orders.forEach((order)=>{
						if(!order.amount) order.amount = undefined ;
						if(order.status) var order_status = 'paid'; else var order_status = 'unpaid'; 
						$('#orders_list').append('<h3>'+order.title+'   '+order_status+'   '+order.serial+'   '+(order.amount||'customize Prize')+'   '+order.description+'</h3><button onclick=\"deleteOrder(\''+order.serial+'\',\''+fb_info.authResponse.userID.toString()+'\');">delete</button>');
					});
				}else{		//order list is empty
					$('#orders_list').append('<h1> you haven\'t create any order link</h1>');
				}
	}
	function upstatus_cb(res){
		console.log(res);
		fb_info = res;
		$.post('./user',{userID:res.authResponse.userID.toString()}).done((data)=>{
			console.log(data);

			userInfo = JSON.parse(data);
						if(userInfo.status == 'failed'){
							window.location.replace('/add_change_user.html');
						}else if(userInfo.status == 'success'){
							showUserInfo(userInfo);
						}else{
							alert('error');
						}

		}).fail(function() {
			alert( "error" );
		});
	}

	function checkLoginState(res) {

			//statusChangeCallback(res);
			switch(res.status){
				case 'connected':		//fb owner LOGINED
					if(res.authResponse){
						upstatus_cb(res);
					}else{

					location.reload();
					}
					
					break;
				case 'not_authorized':			//not login
				FB.login(checkLoginState,{ scope: 'email,public_profile' });;
				//alert(' please auth fb login requirement');
				//location.reload();
					break;
				case 'unknown':					//not login
				FB.login(checkLoginState,{ scope: 'email,public_profile' });
				//alert('fb login error please retry');
				//location.reload();
					break;
				default:						//not login
				//location.reload();
				FB.login(checkLoginState,{ scope: 'email,public_profile' });
				}
			//statusChangeCallback(res);
	
	}




	window.fbAsyncInit = function() {
    FB.init({
      appId      : '2316635168602202',
      cookie     : true,
      xfbml      : true,
      version    : 'v4.0'
    });
      
    FB.AppEvents.logPageView();   
	//checkLoginState();
	FB.getLoginStatus(checkLoginState);
  };
  (function(d, s, id){
	var js, fjs = d.getElementsByTagName(s)[0];
	if (d.getElementById(id)) {return;}
	js = d.createElement(s); js.id = id;
	js.src = "https://connect.facebook.net/en_US/sdk.js";
	fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));

</script>

</body>
</html>